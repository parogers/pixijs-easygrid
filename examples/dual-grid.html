<html>
    <head>
        <script src="https://pixijs.download/dev/pixi.js"></script>
        <script src="require.js"></script>
        <script src="noisejs.js"></script>
        <script src="pixijs-grid.js"></script>
        <script type="module">
            const app = new PIXI.Application();
            await app.init({
                width: 600,
                height: 400,
            });
            app.renderer.background.color = 0xa0a0a0;
            document.body.appendChild(app.canvas);

            const spritesheet = await PIXI.Assets.load('tiles.json');
            spritesheet.textureSource.scaleMode = 'nearest';

            function getTerrain() {
                const noise = new Noise();
                const rows = 1000;
                const cols = 1000;
                const terrain = [];
                for (let row = 0; row < rows; row++) {
                    terrain.push([]);
                    for (let col = 0; col < cols; col++) {
                        const value = noise.simplex2(col/10, row/10);
                        terrain[row].push(value > 0);
                    }
                }
                return terrain;
            }

            const terrain = getTerrain();
            const tiles = Object.keys(spritesheet.data.frames);
            //     'grass-sw',
            //     'grass-e',
            //     'grass-ne-i',
            //     'grass-s',
            //     'grass-nw-se',
            //     'grass-nw-i',
            //     'grass-full',
            //     'grass-se-i',
            //     'grass-ne',
            //     'grass-n',
            //     'grass-sw-i',
            //     'grass-w',
            //     'dirt-full',
            //     'grass-se',
            //     'grass-ne-sw',
            //     'grass-nw',
            // ];
            const dualGrid = new easygrid.DualGrid({
                spritesheet: spritesheet,
                tiles: tiles,
            });
            dualGrid.setTerrain(terrain);
            app.stage.addChild(dualGrid);

            let samples = 0;
            let seconds = 0;
            let total = 0;
            PIXI.Ticker.shared.add((tm) => {
                dualGrid.viewport.x = 350 + Math.cos(tm.lastTime/1200) * 300;
                dualGrid.viewport.y = 350 + Math.cos(tm.lastTime/1400) * 300;
                // Scale the viewport to always match the render area size
                dualGrid.viewport.width = app.renderer.width / app.stage.scale.x;
                dualGrid.viewport.height = app.renderer.height / app.stage.scale.y;

                const second = Math.round(tm.lastTime/1000);
                seconds += tm.elapsedMS/1000;
                total += tm.FPS;
                samples++;
                if (seconds > 1) {
                    const average = total / samples;
                    const fpsEl = document.getElementById('fps');
                    fpsEl.innerText = '' + average;
                    total = 0;
                    samples = 0;
                    seconds = 0;
                }
            });
        </script>
    </head>
    <body>
        <h1>Example: dual-grid rendering</h1>
        <p>Average FPS: <span id="fps"></span></p>
    </body>
</html>
